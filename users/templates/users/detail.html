{% extends 'base.html' %}
{% load django_bootstrap5 %}
{% load static %}
{% block body %}

<div class="con py-5 px-5" style="background-color: rgb(255,255,255)">
    <div class="row mt-5 text-center justify-content-center">
        <h2 class="my-5">{{ user.username }}님의 프로필</h2>
        <div>
            {% if profile.image %}
            <img src="{{ profile.image.url }}" alt="" style="width: 100px; height: 100px;">
            {% else %}
            <img src="https://t3.ftcdn.net/jpg/03/46/83/96/360_F_346839683_6nAPzbhpSkIpb8pmAwufkC7c5eD7wYws.jpg" class="" style="width: 100px; height: 100px;">
            {% endif %}
            <div>
            <br><a href="{% url 'users:profile_update' %}" class='btn btn-outline-success'>프로필 이미지 수정</a>
        </div>
        <br></div>
        <p class="mb-4">이름 :
            {{ user.full_name }}</p>
        <p class="mb-4">이메일 :
            {{ user.email }}</p>
        <p class="mb-4">
            {% if request.user != user %}
            <a href="{% url 'users:follow' user.pk %}">
                {% if request.user in user.followers.all %}
                    <button type="button" class="btn btn-primary btn-sm">팔로우 취소</button>
                {% else %}
                    <button type="button" class="btn btn-primary btn-sm">팔로우</button>
                {% endif %}
            </a>
            {% endif %}
        </p>
        
        <p class="mb-4">팔로워 목록 :
            <a id="detail_btn" data-bs-toggle="modal" data-bs-target="#following_modal">{{user.followers.all.count}}</a>
        </p>
        <div id="following_modal" class="modal fade" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Following</h5>
                        <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        {% for  a in user.followers.all %}
                        <p>
                            <a class="text-decoration-none" href="{% url  'users:detail' a.id %}">
                                {{ a.full_name }}</a>
                        </p>
                        {% endfor %}
                    </div>
                  
                </div>

            </div>
        </div>
        <p class="mb-4">팔로잉 목록 :
            <a id="detail_btn" data-bs-toggle="modal" data-bs-target="#follower_modal">{{follower_list.count}}</a>
        </p>
        <div id="follower_modal" class="modal fade" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Follower</h5>
                        <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        {% for  b in follower_list %}
                        <p>
                            <a class="text-decoration-none" href="{% url  'users:detail' b.id %}">
                                {{ b.full_name }}</a>
                        </p>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
        <div class="d-flex text-start justify-content-evenly">
            <div class="mb-4">
                <h4 class="fw-bold">작성한 글</h4>
                <p class="text-muted">{{ user.review_set.count }}개를 작성하였습니다.</p>
                {% for review in user.review_set.all %}
                <p>
                    <a class="text-decoration-none" href="{% url 'reviews:detail' review.pk %}">{{ review.title }}</a>
                </p>
                {% endfor %}
            </div>
            <div class="mb-4">
                <h4 class="fw-bold">작성한 댓글</h4>
                <p class="text-muted">{{ user.comment_set.count }}개를 작성하였습니다.</p>
                {% for comment in user.comment_set.all %}
                <p>
                    <a class="text-decoration-none" href="{% url 'reviews:detail' comment.review_id %}">
                        {{ comment.content }}</a>
                </p>
                {% endfor %}
            </div>
            <div class="mb-4">
                <a  class="text-decoration-none" href="{% url 'users:wishlist_list' user.id %}">
                <h4 class="fw-bold">위시리스트</h4>
                </a>
                <p class="text-muted">{{ user.user_wishlist.count}}개가  있습니다.</p>

            </div>
        </div>
        <!-- buttons -->
        {% if request.user == user %}
        <div>
            <a class="btn btn-primary me-3" href="{% url 'users:update' %}">수정하기</a>
            <a class="btn btn-outline-primary" href="{% url 'users:index' %}">회원목록</a>
        </div>
        {% else %}
        <div>
            <a class="btn btn-outline-primary" href="{% url 'users:index' %}">회원목록</a>
        </div>
        {% endif %}
    </div>
</div>
{% endblock body %}
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
    const followBtn = document.querySelector('#follow-btn')
  
    followBtn.addEventListener('click', function(event) {
      axios({
        method: 'get',
        url: `/users/${event.target.dataset.userId}/follow/`
      })
      .then(response => {
        console.log(response.data)
        if (response.data.isFollowing === true) {
          event.target.classList.add('btn-outline-danger')
          followBtn.innerText = 'Unfollow'
          event.target.classList.remove('btn-outline-success')
        } else {
          event.target.classList.add('btn-outline-success')
          followBtn.innerText = 'Follow'
          event.target.classList.remove('btn-outline-danger')
        }
  
        const followCnt = document.querySelector('#follow-cnt')
        followCnt.innerHTML = `
          <h3 class="follow">Followers : ${ response.data.followers }</h3>
          <h3 class="follow">Followings : ${ response.data.followings }</h3>
        `
      })
    })
  
  </script>